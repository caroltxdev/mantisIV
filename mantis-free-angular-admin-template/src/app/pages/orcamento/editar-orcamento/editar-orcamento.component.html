<div class="orcamento-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>‚úèÔ∏è Editar Or√ßamento</h1>
      <p class="subtitle">Atualize os dados do or√ßamento #{{ numeroOrcamento }}</p>
    </div>
  </div>

  <!-- Form Container -->
  <div class="form-container">
    <form [formGroup]="orcamentoForm" (ngSubmit)="onSubmit()">
      
      <!-- Se√ß√£o 1: Informa√ß√µes do Cliente -->
      <div class="form-section">
        <h2>üë§ Informa√ß√µes do Cliente</h2>
        
        <div class="form-group">
          <label for="cliente">Cliente *</label>
          <select id="cliente" formControlName="cliente" class="form-control" (change)="onClienteChange($event)">
            <option value="" disabled>Selecione um cliente</option>
            <option value="1">Jo√£o Silva - CNPJ: 12.345.678/0001-90</option>
            <option value="2">Maria Santos - CNPJ: 98.765.432/0001-10</option>
            <option value="3">Pedro Oliveira - CNPJ: 55.555.555/0001-55</option>
            <option value="4">Novo Cliente</option>
          </select>
          <small class="form-text">Selecione um cliente</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="nomeCliente">Nome/Empresa *</label>
            <input 
              type="text" 
              id="nomeCliente" 
              formControlName="nomeCliente" 
              class="form-control"
              placeholder="Nome da empresa"
            >
          </div>

          <div class="form-group">
            <label for="cnpjCpf">CNPJ/CPF *</label>
            <input 
              type="text" 
              id="cnpjCpf" 
              formControlName="cnpjCpf" 
              class="form-control"
              placeholder="00.000.000/0000-00"
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">Email</label>
            <input 
              type="email" 
              id="email" 
              formControlName="email" 
              class="form-control"
              placeholder="email@exemplo.com"
            >
          </div>

          <div class="form-group">
            <label for="telefone">Telefone</label>
            <input 
              type="tel" 
              id="telefone" 
              formControlName="telefone" 
              class="form-control"
              placeholder="(11) 9999-9999"
            >
          </div>
        </div>
      </div>

      <!-- Se√ß√£o 2: Informa√ß√µes do Or√ßamento -->
      <div class="form-section">
        <h2>üìù Informa√ß√µes do Or√ßamento</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="numeroOrcamento">N√∫mero do Or√ßamento</label>
            <input 
              type="text" 
              id="numeroOrcamento" 
              formControlName="numeroOrcamento" 
              class="form-control"
            >
            <small class="form-text">Identificador do or√ßamento</small>
          </div>

          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" formControlName="status" class="form-control">
              <option value="rascunho">Rascunho</option>
              <option value="enviado">Enviado</option>
              <option value="pendente">Pendente</option>
              <option value="aprovado">Aprovado</option>
              <option value="recusado">Recusado</option>
            </select>
          </div>

          <div class="form-group">
            <label for="dataOrcamento">Data do Or√ßamento *</label>
            <input 
              type="date" 
              id="dataOrcamento" 
              formControlName="dataOrcamento" 
              class="form-control"
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dataValidade">Data de Validade *</label>
            <input 
              type="date" 
              id="dataValidade" 
              formControlName="dataValidade" 
              class="form-control"
            >
          </div>

          <div class="form-group">
            <label for="dataCriacao">Data de Cria√ß√£o</label>
            <input 
              type="date" 
              id="dataCriacao" 
              formControlName="dataCriacao" 
              class="form-control"
            >
          </div>
        </div>

        <div class="form-group">
          <label for="observacoes">Observa√ß√µes</label>
          <textarea 
            id="observacoes" 
            formControlName="observacoes" 
            class="form-control"
            rows="3"
            placeholder="Adicione observa√ß√µes importantes sobre o or√ßamento"
          ></textarea>
        </div>
      </div>

      <!-- Se√ß√£o 3: Itens do Or√ßamento -->
      <div class="form-section">
        <div class="section-header">
          <h2>üì¶ Itens do Or√ßamento</h2>
          <button type="button" class="btn-secondary" (click)="adicionarItem()">
            ‚ûï Adicionar Item
          </button>
        </div>

        <div class="items-table">
          <div class="table-header">
            <div class="col-produto">Produto/Servi√ßo</div>
            <div class="col-quantidade">Quantidade</div>
            <div class="col-valor">Valor Unit.</div>
            <div class="col-subtotal">Subtotal</div>
            <div class="col-acoes">A√ß√£o</div>
          </div>

          <div formArrayName="itens" class="table-body">
            <div *ngFor="let item of itens.controls; let i = index" [formGroupName]="i" class="table-row">
              <div class="col-produto">
                <select formControlName="produto" class="form-control-inline" (change)="calcularSubtotal()">
                  <option value="" disabled>Selecione</option>
                  <option value="1">Tomate Premium - kg</option>
                  <option value="2">Alface Crespa - unid</option>
                  <option value="3">Cenoura - kg</option>
                  <option value="4">Ab√≥bora - kg</option>
                  <option value="5">Cebola - kg</option>
                </select>
              </div>
              <div class="col-quantidade">
                <input 
                  type="number" 
                  formControlName="quantidade" 
                  class="form-control-inline"
                  min="0.1"
                  step="0.1"
                  (change)="calcularSubtotal()"
                  placeholder="0"
                >
              </div>
              <div class="col-valor">
                <input 
                  type="number" 
                  formControlName="valorUnitario" 
                  class="form-control-inline"
                  min="0"
                  step="0.01"
                  (change)="calcularSubtotal()"
                  placeholder="0,00"
                >
              </div>
              <div class="col-subtotal">
                <span class="valor-subtotal">{{ calcularSubtotalItem(i) | currency: 'BRL' }}</span>
              </div>
              <div class="col-acoes">
                <button type="button" class="btn-remove" (click)="removerItem(i)" title="Remover item">
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="itens.length === 0" class="empty-state">
          <p>Nenhum item adicionado. Clique em "Adicionar Item" para come√ßar.</p>
        </div>
      </div>

      <!-- Se√ß√£o 4: Resumo Financeiro -->
      <div class="form-section">
        <div class="resumo-financeiro">
          <div class="resumo-item">
            <span class="label">Subtotal</span>
            <span class="valor">{{ calcularSubtotal() | currency: 'BRL' }}</span>
          </div>

          <div class="resumo-item">
            <label for="desconto" class="label">Desconto (%)</label>
            <div class="input-desconto">
              <input 
                type="number" 
                id="desconto" 
                formControlName="desconto" 
                class="form-control-inline"
                min="0"
                max="100"
                step="0.1"
                (change)="calcularTotal()"
              >
              <span class="valor-desconto">- {{ calcularValorDesconto() | currency: 'BRL' }}</span>
            </div>
          </div>

          <div class="resumo-item">
            <label for="imposto" class="label">Imposto (%)</label>
            <div class="input-imposto">
              <input 
                type="number" 
                id="imposto" 
                formControlName="imposto" 
                class="form-control-inline"
                min="0"
                max="100"
                step="0.1"
                (change)="calcularTotal()"
              >
              <span class="valor-imposto">+ {{ calcularValorImposto() | currency: 'BRL' }}</span>
            </div>
          </div>

          <div class="resumo-item total">
            <span class="label">TOTAL</span>
            <span class="valor-total">{{ calcularTotalFinal() | currency: 'BRL' }}</span>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o 5: Condi√ß√µes e A√ß√µes -->
      <div class="form-section">
        <h2>‚úÖ Condi√ß√µes de Pagamento</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="condicaoPagamento">Condi√ß√£o de Pagamento *</label>
            <select id="condicaoPagamento" formControlName="condicaoPagamento" class="form-control">
              <option value="">Selecione</option>
              <option value="vista">√Ä Vista</option>
              <option value="14dias">14 dias</option>
              <option value="30dias">30 dias</option>
              <option value="60dias">60 dias</option>
              <option value="90dias">90 dias</option>
              <option value="parcelado">Parcelado</option>
            </select>
          </div>

          <div class="form-group">
            <label for="formaPagamento">Forma de Pagamento *</label>
            <select id="formaPagamento" formControlName="formaPagamento" class="form-control">
              <option value="">Selecione</option>
              <option value="dinheiro">Dinheiro</option>
              <option value="transferencia">Transfer√™ncia Banc√°ria</option>
              <option value="cartao">Cart√£o de Cr√©dito</option>
              <option value="pix">PIX</option>
              <option value="boleto">Boleto</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Hist√≥rico de Altera√ß√µes -->
      <div class="form-section" *ngIf="historico && historico.length > 0">
        <h2>üìã Hist√≥rico de Altera√ß√µes</h2>
        <div class="historico-list">
          <div *ngFor="let evento of historico" class="historico-item">
            <span class="historico-time">{{ evento.data | date: 'dd/MM/yyyy HH:mm' }}</span>
            <span class="historico-usuario">{{ evento.usuario }}</span>
            <span class="historico-acao">{{ evento.acao }}</span>
          </div>
        </div>
      </div>

      <!-- Bot√µes de A√ß√£o -->
      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="onCancel()">
          ‚Üê Voltar
        </button>
        <button type="button" class="btn-tertiary" (click)="onDelete()">
          üóëÔ∏è Deletar
        </button>
        <button type="button" class="btn-tertiary" (click)="onSaveDraft()">
          üíæ Salvar como Rascunho
        </button>
        <button type="submit" class="btn-primary" [disabled]="!orcamentoForm.valid || itens.length === 0">
          ‚úì Atualizar Or√ßamento
        </button>
      </div>
    </form>
  </div>
</div>
